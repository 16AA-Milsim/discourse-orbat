{{! template-lint-disable require-strict-mode}}
<div
  class={{this.wrapperClass}}
  data-orbat-code={{@node.code}}
  data-orbat-level={{this.level}}
>
  {{#if this.shouldShowHeader}}
    <header
      class={{concat "orbat-node__header" (if this.hasIcon " orbat-node__header--with-icon" "")}}
    >
      {{#if this.hasBadge}}
        <img
          class="orbat-node__badge"
          src={{this.badge}}
          style={{this.badgeStyle}}
          alt=""
          aria-hidden="true"
        />
      {{/if}}
      <div class="orbat-node__title">
        {{#if this.hasIcon}}
          <img
            class="orbat-node__icon"
            src={{this.icon}}
            alt={{@node.label}}
          />
        {{/if}}
        <h3
          class="orbat-node__label"
          style={{this.labelContainerStyle}}
        >
          <span
            class="orbat-node__label-text"
            style={{this.labelTextStyle}}
            {{did-insert this.registerLabelText}}
            {{did-update this.refreshLabelText @node.label this.hasIcon this.labelFontSize}}
            {{will-destroy this.unregisterLabelText}}
          >
            {{@node.label}}
          </span>
        </h3>
      </div>
    </header>
  {{/if}}

  {{#unless this.isNodeHidden}}
    <div class="orbat-node__card">
      {{#if @node.description}}
        <p class="orbat-node__description">
          {{@node.description}}
        </p>
      {{/if}}

      {{#if this.hasUsers}}
        <div class="orbat-node__users">
          {{#each this.userColumns as |column|}}
            <ul class="orbat-node__users-column">
              {{#each column as |user|}}
                <li class="orbat-node__user">
                  {{#if this.showAvatars}}
                    <UserAvatar
                      @user={{user}}
                      @size="small"
                      class="orbat-node__avatar"
                    />
                  {{/if}}
                  <a
                    href={{or user.summaryPath user.profilePath user.path}}
                    class="orbat-node__user-link"
                    {{on "click" (fn this.openSummary user)}}
                  >
                    {{this.formatDisplayName user}}
                  </a>
                </li>
              {{/each}}
            </ul>
          {{/each}}
        </div>
      {{else if this.showPlaceholder}}
        <div class="orbat-node__placeholder">
          {{this.placeholderText}}
        </div>
      {{/if}}
    </div>
  {{/unless}}

  {{#if this.hasChildren}}
    <div class="orbat-node__branches" data-children={{this.childCount}}>
      <div class={{this.childrenClass}} style={{this.childrenStyle}}>
        {{#each this.children as |child|}}
          <div class="orbat-node__branch">
            <OrbatNode @node={{child}} @display={{@display}} />
          </div>
        {{/each}}
      </div>
    </div>
  {{/if}}
</div>
